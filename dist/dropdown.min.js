'use strict';NodeList.prototype.forEach||(NodeList.prototype.forEach=Array.prototype.forEach);var debug=function(){};function closeRelated(a){a.parentElement.querySelectorAll('.open').forEach(function(b){b.classList.remove('open')})}function openNested(a){var b='95%',c='-0.2em';closeRelated(a),a.classList.add('open');var d=a.querySelector('ul'),f=a.getBoundingClientRect(),g=d.getBoundingClientRect();d.style.top='',d.style.bottom='',d.style.left='',d.style.right='',f.right+g.width>window.innerWidth?d.style.right=b:d.style.left=b,f.top+g.height>window.innerHeight?d.style.bottom=c:d.style.top=c}function navClick(a){debug(a.target),a.target.classList.contains('subnav')&&(openNested(a.target),a.stopPropagation())}var elts=document.querySelectorAll('[data-dropdown-trigger]');elts.forEach(function(a){return a.addEventListener('click',function(b){function c(o){debug('mouseenter',o.target),o.target.classList.add('active'),clearTimeout(n),n=o.target.classList.contains('subnav')?setTimeout(openNested.bind(null,o.target),500):setTimeout(closeRelated.bind(null,o.target),500)}function d(o){clearTimeout(n),o.target.classList.remove('active'),debug('mouseleave',o.target)}function f(o){var p=i.querySelectorAll('.open > ul');p=0<p.length?p[p.length-1]:i;var q=p.querySelector('li.active');debug(p);var r;switch(o.keyCode){case 38:o.stopPropagation(),o.preventDefault(),q&&(r=q.previousElementSibling,q.classList.remove('active')),r||(r=p.children[p.children.length-1]),r.classList.add('active');break;case 40:o.stopPropagation(),o.preventDefault(),q&&(r=q.nextElementSibling,q.classList.remove('active')),r||(r=p.children[0]),r.classList.add('active');break;case 37:o.stopPropagation(),o.preventDefault(),q?(q.classList.remove('active'),q.parentElement.parentElement.classList.remove('open'),q.parentElement.parentElement.classList.add('active')):p&&p!==i&&closeRelated(p.parentElement);break;case 39:o.stopPropagation(),o.preventDefault(),q&&(openNested(q),q.querySelector('li').classList.add('active'));break;case 13:o.stopPropagation(),o.preventDefault(),q&&q.click();break;case 27:g();}}function g(){i.classList.remove('opened'),document.removeEventListener('keypress',f),document.removeEventListener('click',g),i.removeEventListener('click',navClick),i.querySelectorAll('li').forEach(function(o){o.classList.remove('open','active'),o.removeEventListener('mouseenter',c),o.removeEventListener('mouseleave',d)})}b.stopPropagation();var h=a.getAttribute('data-dropdown-trigger'),i=document.getElementById(h);if(i.querySelectorAll('.open,.active').forEach(function(o){o.classList.remove('open','active')}),i.classList.add('opened'),b.clientX&&b.clientY)i.style.left=b.clientX+'px',i.style.top=window.pageYOffset+b.clientY+'px';else{var j=a.getBoundingClientRect();debug(j),i.style.top=j.right+'px',i.style.left=j.bottom+'px'}var k=i.getBoundingClientRect();if(k.right>window.innerWidth){var l=i.style.left.replace(/px$/,'');i.style.left=l-k.width+'px'}if(k.bottom>window.innerHeight){var m=i.style.top.replace(/px$/,'');i.style.top=m-k.height+'px'}debug({id:h,nav:i});var n;i.querySelectorAll('li').forEach(function(o){o.addEventListener('mouseenter',c),o.addEventListener('mouseleave',d)}),i.addEventListener('click',navClick),document.addEventListener('keydown',f),document.addEventListener('click',g)})});
