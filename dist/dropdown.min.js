(function(a,b){if('function'==typeof define&&define.amd)define(['exports'],b);else if('undefined'!=typeof exports)b(exports);else{var c={exports:{}};b(c.exports),a.dropdown=c.exports}})(this,function(a){'use strict';function b(f,g){if(!(f instanceof g))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(a,'__esModule',{value:!0});var c=function(){function f(g,h){for(var k,j=0;j<h.length;j++)k=h[j],k.enumerable=k.enumerable||!1,k.configurable=!0,'value'in k&&(k.writable=!0),Object.defineProperty(g,k.key,k)}return function(g,h,j){return h&&f(g.prototype,h),j&&f(g,j),g}}(),d=function(){function f(g){var h=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{logger:console.log.bind(console)};b(this,f),this.logger=h.logger,this.navList=g,this.ul=f.createList(this.navList),this.ul.classList.add('dropdown'),document.body.appendChild(this.ul),this.mouseEnter=this.mouseEnter.bind(this),this.mouseLeave=this.mouseLeave.bind(this),this.dismiss=this.dismiss.bind(this),this.keyboardNavigation=this.keyboardNavigation.bind(this),this.navClick=this.navClick.bind(this)}return c(f,null,[{key:'closeRelated',value:function(h){h.parentElement.querySelectorAll('.open').forEach(function(j){j.classList.remove('open')})}},{key:'openNested',value:function(h){var j='95%',k='-0.2em';f.closeRelated(h),h.classList.add('open');var l=h.querySelector('ul'),m=h.getBoundingClientRect(),n=l.getBoundingClientRect();l.style.top='',l.style.bottom='',l.style.left='',l.style.right='',m.right+n.width>window.innerWidth?l.style.right=j:l.style.left=j,m.top+n.height>window.innerHeight?l.style.bottom=k:l.style.top=k}},{key:'createList',value:function(h){var j=document.createElement('ul');return h.forEach(function(k){var l=document.createElement('li');l.innerText=k.label,k.disabled?(l.classList.add('disabled'),l.addEventListener('click',function(m){m.preventDefault(),m.stopPropagation()})):'string'==typeof k.action?l.addEventListener('click',function(){return window.location.href=k.action}):'function'==typeof k.action&&l.addEventListener('click',k.action),k.children&&(l.appendChild(f.createList(k.children)),l.classList.add('subnav')),j.appendChild(l)}),j}}]),c(f,[{key:'mouseLeave',value:function(h){clearTimeout(this.timeout),h.target.classList.remove('active'),this.logger('mouseleave',h.target)}},{key:'mouseEnter',value:function(h){this.logger('mouseenter',h.target),h.target.classList.add('active'),clearTimeout(this.timeout),this.timeout=h.target.classList.contains('subnav')?setTimeout(f.openNested.bind(null,h.target),500):setTimeout(f.closeRelated.bind(null,h.target),500)}},{key:'navClick',value:function(h){this.logger(h.target),h.target.classList.contains('subnav')&&(f.openNested(h.target),h.stopPropagation())}},{key:'handleClick',value:function(h,j){if(j.stopPropagation(),j.clientX&&j.clientY)this.open(window.pageXOffset+j.clientX,window.pageYOffset+j.clientY);else{var k=h.getBoundingClientRect();this.open(k.right,k.bottom)}}},{key:'open',value:function(h,j){var k=this;this.ul.querySelectorAll('.open,.active').forEach(function(m){m.classList.remove('open','active')}),this.ul.classList.add('opened');var l=this.ul.getBoundingClientRect();this.ul.style.left=h+l.width<window.innerWidth?h+'px':h-l.width+'px',this.ul.style.top=j+l.height<window.innerHeight?j+'px':j-l.height+'px',this.ul.querySelectorAll('li').forEach(function(m){m.addEventListener('mouseenter',k.mouseEnter),m.addEventListener('mouseleave',k.mouseLeave)}),this.ul.addEventListener('click',this.navClick),document.addEventListener('keydown',this.keyboardNavigation),document.addEventListener('click',this.dismiss)}},{key:'keyboardNavigation',value:function(h){var j=this.ul.querySelectorAll('.open > ul');j=0<j.length?j[j.length-1]:this.ul;var k=j.querySelector('li.active');this.logger(j);var l;switch(h.keyCode){case 38:h.stopPropagation(),h.preventDefault(),k&&(l=k.previousElementSibling,k.classList.remove('active')),l||(l=j.children[j.children.length-1]),l.classList.add('active');break;case 40:h.stopPropagation(),h.preventDefault(),k&&(l=k.nextElementSibling,k.classList.remove('active')),l||(l=j.children[0]),l.classList.add('active');break;case 37:h.stopPropagation(),h.preventDefault(),k?(k.classList.remove('active'),k.parentElement.parentElement.classList.remove('open'),k.parentElement.parentElement.classList.add('active')):j&&j!==this.ul&&f.closeRelated(j.parentElement);break;case 39:h.stopPropagation(),h.preventDefault(),k&&(f.openNested(k),k.querySelector('li').classList.add('active'));break;case 13:h.stopPropagation(),h.preventDefault(),k&&k.click();break;case 27:this.dismiss();}}},{key:'dismiss',value:function(){var h=this;this.ul.classList.remove('opened'),document.removeEventListener('keypress',this.keyboardNavigation),document.removeEventListener('click',this.dismiss),this.ul.removeEventListener('click',this.navClick),this.ul.querySelectorAll('li').forEach(function(j){j.classList.remove('open','active'),j.removeEventListener('mouseenter',h.mouseEnter),j.removeEventListener('mouseleave',h.mouseLeave)})}}]),f}();a.default=d});
