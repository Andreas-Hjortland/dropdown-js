'use strict';var _createClass=function(){function a(b,c){for(var f,d=0;d<c.length;d++)f=c[d],f.enumerable=f.enumerable||!1,f.configurable=!0,'value'in f&&(f.writable=!0),Object.defineProperty(b,f.key,f)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();Object.defineProperty(exports,'__esModule',{value:!0});function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var Dropdown=function(){function a(b){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{logger:console.log.bind(console)};_classCallCheck(this,a),this.logger=c.logger,this.navList=b,this.ul=a.createList(this.navList),this.ul.classList.add('dropdown'),document.body.appendChild(this.ul),this.mouseEnter=this.mouseEnter.bind(this),this.mouseLeave=this.mouseLeave.bind(this),this.dismiss=this.dismiss.bind(this),this.keyboardNavigation=this.keyboardNavigation.bind(this),this.navClick=this.navClick.bind(this)}return _createClass(a,null,[{key:'closeRelated',value:function closeRelated(b){b.parentElement.querySelectorAll('.open').forEach(function(c){c.classList.remove('open')})}},{key:'openNested',value:function openNested(b){var c='95%',d='-0.2em';a.closeRelated(b),b.classList.add('open');var f=b.querySelector('ul'),g=b.getBoundingClientRect(),h=f.getBoundingClientRect();f.style.top='',f.style.bottom='',f.style.left='',f.style.right='',g.right+h.width>window.innerWidth?f.style.right=c:f.style.left=c,g.top+h.height>window.innerHeight?f.style.bottom=d:f.style.top=d}},{key:'createList',value:function createList(b){var c=document.createElement('ul');return b.forEach(function(d){var f=document.createElement('li');f.innerText=d.label,d.disabled?(f.classList.add('disabled'),f.addEventListener('click',function(g){g.preventDefault(),g.stopPropagation()})):'string'==typeof d.action?f.addEventListener('click',function(){return window.location.href=d.action}):'function'==typeof d.action&&f.addEventListener('click',d.action),d.children&&(f.appendChild(a.createList(d.children)),f.classList.add('subnav')),c.appendChild(f)}),c}}]),_createClass(a,[{key:'mouseLeave',value:function mouseLeave(b){clearTimeout(this.timeout),b.target.classList.remove('active'),this.logger('mouseleave',b.target)}},{key:'mouseEnter',value:function mouseEnter(b){this.logger('mouseenter',b.target),b.target.classList.add('active'),clearTimeout(this.timeout),this.timeout=b.target.classList.contains('subnav')?setTimeout(a.openNested.bind(null,b.target),500):setTimeout(a.closeRelated.bind(null,b.target),500)}},{key:'navClick',value:function navClick(b){this.logger(b.target),b.target.classList.contains('subnav')&&(a.openNested(b.target),b.stopPropagation())}},{key:'handleClick',value:function handleClick(b,c){if(c.stopPropagation(),c.clientX&&c.clientY)this.open(window.pageXOffset+c.clientX,window.pageYOffset+c.clientY);else{var d=b.getBoundingClientRect();this.open(d.right,d.bottom)}}},{key:'open',value:function open(b,c){var f=this;this.ul.querySelectorAll('.open,.active').forEach(function(g){g.classList.remove('open','active')}),this.ul.classList.add('opened');var d=this.ul.getBoundingClientRect();this.ul.style.left=b+d.width<window.innerWidth?b+'px':b-d.width+'px',this.ul.style.top=c+d.height<window.innerHeight?c+'px':c-d.height+'px',this.ul.querySelectorAll('li').forEach(function(g){g.addEventListener('mouseenter',f.mouseEnter),g.addEventListener('mouseleave',f.mouseLeave)}),this.ul.addEventListener('click',this.navClick),document.addEventListener('keydown',this.keyboardNavigation),document.addEventListener('click',this.dismiss)}},{key:'keyboardNavigation',value:function keyboardNavigation(b){var c=this.ul.querySelectorAll('.open > ul');c=0<c.length?c[c.length-1]:this.ul;var d=c.querySelector('li.active');this.logger(c);var f;switch(b.keyCode){case 38:b.stopPropagation(),b.preventDefault(),d&&(f=d.previousElementSibling,d.classList.remove('active')),f||(f=c.children[c.children.length-1]),f.classList.add('active');break;case 40:b.stopPropagation(),b.preventDefault(),d&&(f=d.nextElementSibling,d.classList.remove('active')),f||(f=c.children[0]),f.classList.add('active');break;case 37:b.stopPropagation(),b.preventDefault(),d?(d.classList.remove('active'),d.parentElement.parentElement.classList.remove('open'),d.parentElement.parentElement.classList.add('active')):c&&c!==this.ul&&a.closeRelated(c.parentElement);break;case 39:b.stopPropagation(),b.preventDefault(),d&&(a.openNested(d),d.querySelector('li').classList.add('active'));break;case 13:b.stopPropagation(),b.preventDefault(),d&&d.click();break;case 27:this.dismiss();}}},{key:'dismiss',value:function dismiss(){var b=this;this.ul.classList.remove('opened'),document.removeEventListener('keypress',this.keyboardNavigation),document.removeEventListener('click',this.dismiss),this.ul.removeEventListener('click',this.navClick),this.ul.querySelectorAll('li').forEach(function(c){c.classList.remove('open','active'),c.removeEventListener('mouseenter',b.mouseEnter),c.removeEventListener('mouseleave',b.mouseLeave)})}}]),a}();exports.default=Dropdown;
